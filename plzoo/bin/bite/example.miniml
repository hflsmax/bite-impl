eff Fget : ∀[].∀{}.() -> int_[] ;;
eff Fset : ∀[].∀{}.() -> int_[] ;;

let counter =
  fun f [] {l_get : Fget, l_set : Fset} (n : int) : int is
    let i = l_get () in
      if i = 0 then 
        n 
      else 
        l_set (i-1) ; f (n+1)
in let main =
  fun _ [] {} (n : int) : int is
    dcl s := n in
      handle l_get : Fget = (fun [] {} (n : int) : int is s := n) in
        handle l_set : Fset = (fun [] {} (n : int) : int is s) in
          counter l_get l_set n
in main 10
;;

