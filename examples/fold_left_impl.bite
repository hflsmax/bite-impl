eff NoSuchElement : ∀[].∀{}.() -> int_[];;

let arrLen = 100100100 in
let arr = ArrayInit arrLen in

dcl iterIdx := 0 in
let iterNext = fn [] {exc : NoSuchElement} () : int_[~exc] is 
    if !iterIdx < arrLen then
        iterIdx := !iterIdx + 1;
        ArrayGet arr (!iterIdx - 1)
    else
        raise exc ()
end in

let add = fn [] {} (a : int, b : int) : int_[] is a + b end in

let foldLeft =
    fun foldLeftRec [] {} (op : ∀[].∀{}.(int, int) -> int_[], acc : int) : int_[] is
        dcl next := 0 in
        dcl toBreak := false in
            handle exc : NoSuchElement = fn [] {} () : int_[] is toBreak := true end in
                next := iterNext {exc} ()
            end;
            if (!toBreak) then
                acc
            else
                foldLeftRec op (op acc !next)
        end
        end
    end 
in
    Print (foldLeft add 0)
end
end
end
end
end
end